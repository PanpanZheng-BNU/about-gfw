<!DOCTYPE html>
<html>
<head>
    <title>科学上网介绍</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--    <link rel="stylesheet"-->
    <!--          href="file:///c:\Users\pdxgs\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.5.16\node_modules\@shd101wyy\mume\dependencies\katex\katex.min.css">-->

    <style>
        /**
   * prism.js Github theme based on GitHub's theme.
   * @author Sam Clarke
   */
        code[class*="language-"],
        pre[class*="language-"] {
            color: #333;
            background: none;
            font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
            text-align: left;
            white-space: pre;
            word-spacing: normal;
            word-break: normal;
            word-wrap: normal;
            line-height: 1.4;

            -moz-tab-size: 8;
            -o-tab-size: 8;
            tab-size: 8;

            -webkit-hyphens: none;
            -moz-hyphens: none;
            -ms-hyphens: none;
            hyphens: none;
        }

        /* Code blocks */
        pre[class*="language-"] {
            padding: .8em;
            overflow: auto;
            /* border: 1px solid #ddd; */
            border-radius: 3px;
            /* background: #fff; */
            background: #f5f5f5;
        }

        /* Inline code */
        :not(pre) > code[class*="language-"] {
            padding: .1em;
            border-radius: .3em;
            white-space: normal;
            background: #f5f5f5;
        }

        .token.comment,
        .token.blockquote {
            color: #969896;
        }

        .token.cdata {
            color: #183691;
        }

        .token.doctype,
        .token.punctuation,
        .token.variable,
        .token.macro.property {
            color: #333;
        }

        .token.operator,
        .token.important,
        .token.keyword,
        .token.rule,
        .token.builtin {
            color: #a71d5d;
        }

        .token.string,
        .token.url,
        .token.regex,
        .token.attr-value {
            color: #183691;
        }

        .token.property,
        .token.number,
        .token.boolean,
        .token.entity,
        .token.atrule,
        .token.constant,
        .token.symbol,
        .token.command,
        .token.code {
            color: #0086b3;
        }

        .token.tag,
        .token.selector,
        .token.prolog {
            color: #63a35c;
        }

        .token.function,
        .token.namespace,
        .token.pseudo-element,
        .token.class,
        .token.class-name,
        .token.pseudo-class,
        .token.id,
        .token.url-reference .token.variable,
        .token.attr-name {
            color: #795da3;
        }

        .token.entity {
            cursor: help;
        }

        .token.title,
        .token.title .token.punctuation {
            font-weight: bold;
            color: #1d3e81;
        }

        .token.list {
            color: #ed6a43;
        }

        .token.inserted {
            background-color: #eaffea;
            color: #55a532;
        }

        .token.deleted {
            background-color: #ffecec;
            color: #bd2c00;
        }

        .token.bold {
            font-weight: bold;
        }

        .token.italic {
            font-style: italic;
        }


        /* JSON */
        .language-json .token.property {
            color: #183691;
        }

        .language-markup .token.tag .token.punctuation {
            color: #333;
        }

        /* CSS */
        code.language-css,
        .language-css .token.function {
            color: #0086b3;
        }

        /* YAML */
        .language-yaml .token.atrule {
            color: #63a35c;
        }

        code.language-yaml {
            color: #183691;
        }

        /* Ruby */
        .language-ruby .token.function {
            color: #333;
        }

        /* Markdown */
        .language-markdown .token.url {
            color: #795da3;
        }

        /* Makefile */
        .language-makefile .token.symbol {
            color: #795da3;
        }

        .language-makefile .token.variable {
            color: #183691;
        }

        .language-makefile .token.builtin {
            color: #0086b3;
        }

        /* Bash */
        .language-bash .token.keyword {
            color: #0086b3;
        }

        /* highlight */
        pre[data-line] {
            position: relative;
            padding: 1em 0 1em 3em;
        }

        pre[data-line] .line-highlight-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            background-color: transparent;
            display: block;
            width: 100%;
        }

        pre[data-line] .line-highlight {
            position: absolute;
            left: 0;
            right: 0;
            padding: inherit 0;
            margin-top: 1em;
            background: hsla(24, 20%, 50%, .08);
            background: linear-gradient(to right, hsla(24, 20%, 50%, .1) 70%, hsla(24, 20%, 50%, 0));
            pointer-events: none;
            line-height: inherit;
            white-space: pre;
        }

        pre[data-line] .line-highlight:before,
        pre[data-line] .line-highlight[data-end]:after {
            content: attr(data-start);
            position: absolute;
            top: .4em;
            left: .6em;
            min-width: 1em;
            padding: 0 .5em;
            background-color: hsla(24, 20%, 50%, .4);
            color: hsl(24, 20%, 95%);
            font: bold 65%/1.5 sans-serif;
            text-align: center;
            vertical-align: .3em;
            border-radius: 999px;
            text-shadow: none;
            box-shadow: 0 1px white;
        }

        pre[data-line] .line-highlight[data-end]:after {
            content: attr(data-end);
            top: auto;
            bottom: .4em;
        }

        html body {
            font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
            font-size: 16px;
            line-height: 1.6;
            color: #333;
            background-color: #fff;
            overflow: initial;
            box-sizing: border-box;
            word-wrap: break-word
        }

        html body > :first-child {
            margin-top: 0
        }

        html body h1, html body h2, html body h3, html body h4, html body h5, html body h6 {
            line-height: 1.2;
            margin-top: 1em;
            margin-bottom: 16px;
            color: #000
        }

        html body h1 {
            font-size: 2.25em;
            font-weight: 300;
            padding-bottom: .3em
        }

        html body h2 {
            font-size: 1.75em;
            font-weight: 400;
            padding-bottom: .3em
        }

        html body h3 {
            font-size: 1.5em;
            font-weight: 500
        }

        html body h4 {
            font-size: 1.25em;
            font-weight: 600
        }

        html body h5 {
            font-size: 1.1em;
            font-weight: 600
        }

        html body h6 {
            font-size: 1em;
            font-weight: 600
        }

        html body h1, html body h2, html body h3, html body h4, html body h5 {
            font-weight: 600
        }

        html body h5 {
            font-size: 1em
        }

        html body h6 {
            color: #5c5c5c
        }

        html body strong {
            color: #000
        }

        html body del {
            color: #5c5c5c
        }

        html body a:not([href]) {
            color: inherit;
            text-decoration: none
        }

        html body a {
            color: #08c;
            text-decoration: none
        }

        html body a:hover {
            color: #00a3f5;
            text-decoration: none
        }

        html body img {
            max-width: 100%
        }

        html body > p {
            margin-top: 0;
            margin-bottom: 16px;
            word-wrap: break-word
        }

        html body > ul, html body > ol {
            margin-bottom: 16px
        }

        html body ul, html body ol {
            padding-left: 2em
        }

        html body ul.no-list, html body ol.no-list {
            padding: 0;
            list-style-type: none
        }

        html body ul ul, html body ul ol, html body ol ol, html body ol ul {
            margin-top: 0;
            margin-bottom: 0
        }

        html body li {
            margin-bottom: 0
        }

        html body li.task-list-item {
            list-style: none
        }

        html body li > p {
            margin-top: 0;
            margin-bottom: 0
        }

        html body .task-list-item-checkbox {
            margin: 0 .2em .25em -1.8em;
            vertical-align: middle
        }

        html body .task-list-item-checkbox:hover {
            cursor: pointer
        }

        html body blockquote {
            margin: 16px 0;
            font-size: inherit;
            padding: 0 15px;
            color: #5c5c5c;
            background-color: #f0f0f0;
            border-left: 4px solid #d6d6d6
        }

        html body blockquote > :first-child {
            margin-top: 0
        }

        html body blockquote > :last-child {
            margin-bottom: 0
        }

        html body hr {
            height: 4px;
            margin: 32px 0;
            background-color: #d6d6d6;
            border: 0 none
        }

        html body table {
            margin: 10px 0 15px 0;
            border-collapse: collapse;
            border-spacing: 0;
            display: block;
            width: 100%;
            overflow: auto;
            word-break: normal;
            word-break: keep-all
        }

        html body table th {
            font-weight: bold;
            color: #000
        }

        html body table td, html body table th {
            border: 1px solid #d6d6d6;
            padding: 6px 13px
        }

        html body dl {
            padding: 0
        }

        html body dl dt {
            padding: 0;
            margin-top: 16px;
            font-size: 1em;
            font-style: italic;
            font-weight: bold
        }

        html body dl dd {
            padding: 0 16px;
            margin-bottom: 16px
        }

        html body code {
            font-family: Menlo, Monaco, Consolas, 'Courier New', monospace;
            font-size: .85em !important;
            color: #000;
            background-color: #f0f0f0;
            border-radius: 3px;
            padding: .2em 0
        }

        html body code::before, html body code::after {
            letter-spacing: -0.2em;
            content: "\00a0"
        }

        html body pre > code {
            padding: 0;
            margin: 0;
            font-size: .85em !important;
            word-break: normal;
            white-space: pre;
            background: transparent;
            border: 0
        }

        html body .highlight {
            margin-bottom: 16px
        }

        html body .highlight pre, html body pre {
            padding: 1em;
            overflow: auto;
            font-size: .85em !important;
            line-height: 1.45;
            border: #d6d6d6;
            border-radius: 3px
        }

        html body .highlight pre {
            margin-bottom: 0;
            word-break: normal
        }

        html body pre code, html body pre tt {
            display: inline;
            max-width: initial;
            padding: 0;
            margin: 0;
            overflow: initial;
            line-height: inherit;
            word-wrap: normal;
            background-color: transparent;
            border: 0
        }

        html body pre code:before, html body pre tt:before, html body pre code:after, html body pre tt:after {
            content: normal
        }

        html body p, html body blockquote, html body ul, html body ol, html body dl, html body pre {
            margin-top: 0;
            margin-bottom: 16px
        }

        html body kbd {
            color: #000;
            border: 1px solid #d6d6d6;
            border-bottom: 2px solid #c7c7c7;
            padding: 2px 4px;
            background-color: #f0f0f0;
            border-radius: 3px
        }

        @media print {
            html body {
                background-color: #fff
            }

            html body h1, html body h2, html body h3, html body h4, html body h5, html body h6 {
                color: #000;
                page-break-after: avoid
            }

            html body blockquote {
                color: #5c5c5c
            }

            html body pre {
                page-break-inside: avoid
            }

            html body table {
                display: table
            }

            html body img {
                display: block;
                max-width: 100%;
                max-height: 100%
            }

            html body pre, html body code {
                word-wrap: break-word;
                white-space: pre
            }
        }

        .markdown-preview {
            width: 100%;
            height: 100%;
            box-sizing: border-box
        }

        .markdown-preview .pagebreak, .markdown-preview .newpage {
            page-break-before: always
        }

        .markdown-preview pre.line-numbers {
            position: relative;
            padding-left: 3.8em;
            counter-reset: linenumber
        }

        .markdown-preview pre.line-numbers > code {
            position: relative
        }

        .markdown-preview pre.line-numbers .line-numbers-rows {
            position: absolute;
            pointer-events: none;
            top: 1em;
            font-size: 100%;
            left: 0;
            width: 3em;
            letter-spacing: -1px;
            border-right: 1px solid #999;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        .markdown-preview pre.line-numbers .line-numbers-rows > span {
            pointer-events: none;
            display: block;
            counter-increment: linenumber
        }

        .markdown-preview pre.line-numbers .line-numbers-rows > span:before {
            content: counter(linenumber);
            color: #999;
            display: block;
            padding-right: .8em;
            text-align: right
        }

        .markdown-preview .mathjax-exps .MathJax_Display {
            text-align: center !important
        }

        .markdown-preview:not([for="preview"]) .code-chunk .btn-group {
            display: none
        }

        .markdown-preview:not([for="preview"]) .code-chunk .status {
            display: none
        }

        .markdown-preview:not([for="preview"]) .code-chunk .output-div {
            margin-bottom: 16px
        }

        .scrollbar-style::-webkit-scrollbar {
            width: 8px
        }

        .scrollbar-style::-webkit-scrollbar-track {
            border-radius: 10px;
            background-color: transparent
        }

        .scrollbar-style::-webkit-scrollbar-thumb {
            border-radius: 5px;
            background-color: rgba(150, 150, 150, 0.66);
            border: 4px solid rgba(150, 150, 150, 0.66);
            background-clip: content-box
        }

        html body[for="html-export"]:not([data-presentation-mode]) {
            position: relative;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            margin: 0;
            padding: 0;
            overflow: auto
        }

        html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview {
            position: relative;
            top: 0
        }

        @media screen and (min-width: 914px) {
            html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview {
                padding: 2em calc(50% - 457px + 2em)
            }
        }

        @media screen and (max-width: 914px) {
            html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview {
                padding: 2em
            }
        }

        @media screen and (max-width: 450px) {
            html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview {
                font-size: 14px !important;
                padding: 1em
            }
        }

        @media print {
            html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn {
                display: none
            }
        }

        html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn {
            position: fixed;
            bottom: 8px;
            left: 8px;
            font-size: 28px;
            cursor: pointer;
            color: inherit;
            z-index: 99;
            width: 32px;
            text-align: center;
            opacity: .4
        }

        html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn {
            opacity: 1
        }

        html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc {
            position: fixed;
            top: 0;
            left: 0;
            width: 300px;
            height: 100%;
            padding: 32px 0 48px 0;
            font-size: 14px;
            box-shadow: 0 0 4px rgba(150, 150, 150, 0.33);
            box-sizing: border-box;
            overflow: auto;
            background-color: inherit
        }

        html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar {
            width: 8px
        }

        html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track {
            border-radius: 10px;
            background-color: transparent
        }

        html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb {
            border-radius: 5px;
            background-color: rgba(150, 150, 150, 0.66);
            border: 4px solid rgba(150, 150, 150, 0.66);
            background-clip: content-box
        }

        html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a {
            text-decoration: none
        }

        html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul {
            padding: 0 1.6em;
            margin-top: .8em
        }

        html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li {
            margin-bottom: .8em
        }

        html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul {
            list-style-type: none
        }

        html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview {
            left: 300px;
            width: calc(100% - 300px);
            padding: 2em calc(50% - 457px - 150px);
            margin: 0;
            box-sizing: border-box
        }

        @media screen and (max-width: 1274px) {
            html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview {
                padding: 2em
            }
        }

        @media screen and (max-width: 450px) {
            html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview {
                width: 100%
            }
        }

        html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview {
            left: 50%;
            transform: translateX(-50%)
        }

        html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc {
            display: none
        }

        /* Please visit the URL below for more information: */
        /*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

    </style>
</head>
<body for="html-export">
<div class="mume markdown-preview  ">
    <h1 class="mume-header" id="center%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91%E4%BB%8B%E7%BB%8Dcenter"><strong>
        <center>科学上网介绍</center>
    </strong></h1>

    <p><em><strong></strong></em></p>
    <center><em><strong>我们仍未知道如今GFW侦测和封锁的原理</strong></em>
    </center>
    <p></p>
    <h2>主流的三种方式</h2>
    <h3 class="mume-header" id="shadowsocks">Shadowsocks</h3>

    <ul>
        <li>
            <h4>协议</h4>
            <ul>
                <li><em><strong>shadowsocks</strong></em> 及基于shadowsocks的 <em><strong>shadowsocksR</strong></em>。
                </li>
            </ul>
        </li>
        <li>
            <h4>原理</h4>
            <ul>
                <li>
                    <p>如下图所示，且v2ray及trojan的总体原理和此原理几乎相同。<br>
                    </p>
                    <blockquote>
                        <p><br><strong>1.</strong> 本地PC对某个被墙得网站发出访问请求，这个请求首先会送到本地的SS（或SSR）客户端。<br>
                            <strong>2.</strong>
                            SS（或SSR）客户端对用户发出的访问请求进行加密，并发送给海外的SS服务器端。当数据到达GFW时，由于数据被加密，GFW无法甄别用户想要访问的内容，只得将该数据放行。<br>
                            <strong>3.</strong> SS服务器端接收到用户加密的访问请求后，首先会对该请求进行解密，然后再根据解密后的数据，对相应的网站提出相应的访问请求。<br>
                            <strong>4.</strong> 然后，SS服务器端再对访问得到的数据进行相应的加密。<br>
                            <strong>5.</strong> 同样因为数据被加密，GFW只得放行该数据。最后，用户本地PC上的SS（或SSR）客户端对远程返回的数据进行解密，得到访
                            (fan) 问 (qiang) 结果。<br><br></p>
                    </blockquote>
                    <p><img src="/images/GFW-ss.png" alt="shadowsocks 原理"><br></p>
                </li>
            </ul>
        </li>
        <li>
            <h4>优点</h4>
            <ul>
                <li>搭建简单，可用现成的一键脚本进行搭建，且不涉及Nginx等web服务器的搭建；</li>
                <li>基于协议原理的优势：在同样线路的情况下ping值相对另外两种协议而言更低；</li>
            </ul>
        </li>
        <li>
            <h4>缺点</h4>
            <ul>
                <li>由于协议相对古老，GFW对此协议具有一定的侦测方法。一些知名VPS厂商（vultr,
                    Digital Ocean）的IP (IPV4) 很容易在搭建完Shadowsocks后被封。
                </li>
            </ul>
        </li>
        <li>
            <h4>建议使用场景</h4>
            <ul>
                <li>搭建IPV6的节点。首先，GFW目前并没有针对IPV6的封锁；其次，IPV6超不值钱，很多VPS厂商会提供多个IPV6的地址，哪怕某个IP被封了，依然还可以使用其他的IP。</li>
                <li>使用小众厂商的VPS搭建。</li>
            </ul>
        </li>
        <li>
            <h4>搭建方法</h4>
            <ul>
                <li><em><strong>Shadowsocks</strong></em> 一键脚本搭建</li>
            </ul>
            <pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment"># 首先，下载并执行shadowsocks一键脚本进行安装：</span>
<span class="token comment"># 下载Shadowsocks一键脚本</span>
<span class="token function">wget</span> –no-check-certificate https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks.sh
<span class="token comment"># 为下载下来的一键脚本赋予权限，Linux中对于.sh文件只有在赋予权限后才可运行</span>
<span class="token function">chmod</span> +x shadowsocks.sh
<span class="token comment"># 执行一键脚本，然后根据一键脚本的提示一步一步操作即可</span>
./shadowsocks.sh <span class="token operator"><span class="token file-descriptor important">2</span>></span><span
                        class="token file-descriptor important">&1</span> <span
                        class="token operator">|</span> <span class="token function">tee</span> shadowsocks.log

<span class="token comment"># 然后，修改配置文件内容，使其可以使用IPV6连接</span>
<span class="token comment"># 打开配置文件</span>
<span class="token function">vim</span> /etc/shadowsocks.json

<span class="token comment"># 将server后的0.0.0.0改为::</span>

<span class="token comment"># 退出配置文件</span>
<span class="token comment">## 先按Esc退出编辑模式</span>
<span class="token comment">## 然后按 Shift + :</span>
<span class="token comment">## 最后输入wq并按回车键退出</span>
</pre>
            <ul>
                <li><em><strong>ShadowsocksR</strong></em> 一键脚本搭建</li>
            </ul>
            <pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment"># 下载并执行shadowsocks一键脚本进行安装：</span>
<span class="token comment"># 下载Shadowsocks一键脚本</span>
<span class="token function">wget</span> --no-check-certificate https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocksR.sh

<span class="token comment"># 为下载下来的一键脚本赋予权限，Linux中对于脚本文件只有在赋予权限后才可运行</span>
<span class="token function">chmod</span> +x shadowsocksR.sh

<span class="token comment"># 执行一键脚本，然后根据一键脚本的提示一步一步操作即可</span>
./shadowsocksR.sh <span class="token operator"><span class="token file-descriptor important">2</span>></span><span
                        class="token file-descriptor important">&1</span> <span
                        class="token operator">|</span> <span class="token function">tee</span> shadowsocksR.log

ShadowsocksR意见脚本本身就支持IPV6连接，故不需要修改配置文件！！！
</pre>
        </li>
    </ul>
    <h3 class="mume-header" id="v2ray">v2ray</h3>

    <ul>
        <li>
            <h4>协议</h4>
            <ul>
                <li><em><strong>vmess</strong></em> 及较新的 <em><strong>vless</strong></em>。
                </li>
            </ul>
        </li>
        <li>
            <h4>原理</h4>
            <ul>
                <li>
                    <h5>整体原理：和Shadowsocks相同</h5>
                    <p><img src="/images/GFW-v2ray.png" alt="v2ray 基本原理"><br></p>
                </li>
                <li>
                    <h5>vmess + ws + tls + nginx</h5>
                    <blockquote>
                        <h6><br>与Shadowsocks的不同点</h6>
                        <p>v2ray Local和v2ray
                            Server之间通过<strong>TLS加密</strong>进行通信。TLS加密常用于HTTPS网站，因此和访问一般的HTTPS网站流量特征相同。目前GFW很难从每天数以千万计的TLS通信中分辨出哪些是正常的HTTPS网站访问流量，哪些是v2ray的翻墙流量，只得将该流量放行。<br><br>
                        </p>
                        <h6>v2ray Server内部</h6>
                        <p>Nginx会接受来自外界（用户）的web访问请求，这种访问有两种情况：</p>
                        <ol>
                            <li><strong><font
                                    color="#2EA9DF">网页访问请求</font></strong>，Nginx会将其引导至事先部署好的网页，并返回给用户正常的网页。因此，从外界来看就是一个简单的网页。并没有任何其他奇怪的功能。
                            </li>
                            <li><strong><font color="#D44931">v2ray访问请求</font></strong>，我们可以发现和正常网页访问的URL相比，v2ray访问时会在域名后加一个
                                <em><strong>Direction</strong></em>
                                （如图中的/v2ray），这个Direction可以自定义，且建议将Direction命名为较复杂的字符串，以规避GFW的主动探测。Nginx通过该Direction将v2ray的访问流量引入服务器上的v2ray
                                Server，然后该v2ray Server对外网进行访问，并向PC传回访问得到的数据，实现代理效果。<br><br>
                            </li>
                        </ol>
                    </blockquote>
                    <p><img src="/images/GFW-v2ray+ws+tls.png" alt="v2ray+ws+tls 原理"><br><br></p>
                </li>
            </ul>
        </li>
        <li>
            <h4>优点</h4>
            <ul>
                <li>由于其流量特征和一般的HTTPS流量特征极其相似，所以很难被GFW侦测到。</li>
                <li>即使IP被封依然还可以使用<strong>CDN服务</strong>来连接IP被墙的服务器。
                </li>
            </ul>
        </li>
        <li>
            <h4>缺点</h4>
            <ul>
                <li>搭建较为复杂；需要有一定的Nginx
                    Web服务器的知识。
                </li>
                <li>由于协议原理的限制，ping值较Shadowsocks更高。</li>
            </ul>
        </li>
        <li>
            <h4>建议使用场景</h4>
            <ul>
                <li>几乎所有的IPV4的VPS。</li>
                <li>对ping值要求较低，而对安全性和稳定性要求较高。</li>
            </ul>
        </li>
        <li>
            <h4>搭建方法</h4>
            <h5>
                <center> Nginx部分</center>
            </h5>
            <ul>
                <li>
                    <p>由于要进行TLS通信，所以需要将域名解析到IP上，并<strong>申请SSL证书</strong>。
                    </p>
                    <pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment"># 更新apt-get库并安装域名证书申请所需的库</span>
<span class="token function">apt-get</span> update <span class="token operator">&&</span> <span
                                class="token function">apt-get</span> -y <span class="token function">install</span> socat <span
                                class="token function">curl</span>

<span class="token comment"># 安装acme.sh脚本并让环境变量生效</span>
<span class="token function">curl</span> https://get.acme.sh <span class="token operator">|</span> <span
                                class="token function">sh</span>
<span class="token builtin class-name">source</span> ~/.bashrc

<span class="token comment"># 使用acme.sh签发证书（需要先将域名解析到ip上），***注意将example.com换成自己的域名***</span>
acme.sh --issue -d example.com --standalone -k ec-256 --force

<span class="token comment"># 创建用于存放证书的目录，***注意将example.com换成自己的域名***</span>
<span class="token function">mkdir</span> /data
<span class="token function">mkdir</span> /data/example.com

<span class="token comment"># 安装证书，***注意将example.com换成自己的域名（共3处）***</span>
acme.sh --installcert -d example.com --fullchainpath /data/example.com/fullchain.crt --keypath /data/example.com/privkey.key --ecc --force
</pre>
                </li>
                <li>
                    <p><strong>安装Nginx</strong></p>
                    <pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment"># 下载Nginx安装依赖 (OpenSSL)</span>
<span class="token builtin class-name">cd</span> /usr/local/src
<span class="token function">wget</span> -nc --no-check-certificate https://www.openssl.org/source/openssl-1.1.1g.tar.gz -P /usr/local/src
<span class="token function">tar</span> -zxvf  /usr/local/src/openssl-1.1.1g.tar.gz  -C /usr/local/src
<span class="token comment"># 安装其他依赖</span>
<span class="token function">apt-get</span> -y <span class="token function">install</span> build-essential libpcre3 libpcre3-dev zlib1g-dev <span
                                class="token function">git</span>  dbus manpages-dev <span class="token function">aptitude</span> g++


<span class="token comment"># 下载并解压Nginx</span>
<span class="token function">wget</span> -nc --no-check-certificate http://nginx.org/download/nginx-1.18.0.tar.gz -P /usr/local/src
<span class="token function">tar</span> -zxvf /usr/local/src/nginx-1.18.0.tar.gz -C /usr/local/src


<span class="token comment"># 编译配置</span>
<span class="token builtin class-name">cd</span> /usr/local/src/nginx-1.18.0
<span class="token function">mkdir</span> /etc/nginx
./configure --prefix<span class="token operator">=</span>/etc/nginx <span class="token punctuation">\</span>
        --with-http_ssl_module <span class="token punctuation">\</span>
        --with-http_gzip_static_module <span class="token punctuation">\</span>
        --with-http_stub_status_module <span class="token punctuation">\</span>
        --with-pcre <span class="token punctuation">\</span>
        --with-http_realip_module <span class="token punctuation">\</span>
        --with-http_flv_module <span class="token punctuation">\</span>
        --with-http_mp4_module <span class="token punctuation">\</span>
        --with-http_secure_link_module <span class="token punctuation">\</span>
        --with-http_v2_module <span class="token punctuation">\</span>
        --with-cc-opt<span class="token operator">=</span><span class="token string">&apos;-O3&apos;</span> <span
                                class="token punctuation">\</span>
        --with-openssl<span class="token operator">=</span><span
                                class="token punctuation">..</span>/openssl-1.1.1g <span
                                class="token punctuation">\</span>
        --with-stream <span class="token punctuation">\</span>
        --with-stream_ssl_preread_module
<span class="token comment"># 编译&安装</span>
<span class="token function">make</span> <span class="token operator">&&</span> <span class="token function">make</span> <span
                                class="token function">install</span>
<span class="token comment"># 修改基本配置</span>
<span class="token function">sed</span> -i <span class="token string">&apos;s/#user  nobody;/user  root;/&apos;</span> /etc/nginx/conf/nginx.conf
<span class="token function">sed</span> -i <span class="token string">&apos;s/worker_processes  1;/worker_processes  3;/&apos;</span> /etc/nginx/conf/nginx.conf
<span class="token function">sed</span> -i <span class="token string">&apos;s/    worker_connections  1024;/    worker_connections  4096;/&apos;</span> /etc/nginx/conf/nginx.conf
<span class="token function">sed</span> -i <span class="token string">&apos;<span class="token variable">$i</span> include conf.d/*.conf;&apos;</span> /etc/nginx/conf/nginx.conf


<span class="token comment"># 新建配置文件文件夹</span>
<span class="token function">mkdir</span> /etc/nginx/conf/conf.d


<span class="token comment"># 创建服务文件</span>
<span class="token function">cat</span> <span class="token operator">></span>/etc/systemd/system/nginx.service <span
                                class="token operator"><<</span><span class="token string">EOF
[Unit]
Description=The NGINX HTTP and reverse proxy server
After=syslog.target network.target remote-fs.target nss-lookup.target
[Service]
Type=forking
PIDFile=/etc/nginx/logs/nginx.pid
ExecStartPre=/etc/nginx/sbin/nginx -t
ExecStart=/etc/nginx/sbin/nginx -c /etc/nginx/conf/nginx.conf
ExecReload=/etc/nginx/sbin/nginx -s reload
ExecStop=/bin/kill -s QUIT \<span class="token variable">$MAINPID</span>
PrivateTmp=true
[Install]
WantedBy=multi-user.target
EOF</span>

<span class="token comment"># 重新加载systemctl</span>
systemctl daemon-reload
<span class="token comment"># 重启nginx</span>
systemctl restart nginx

<span class="token comment">## 附nginx其他操作：</span>
<span class="token comment"># 关闭nginx</span>
systemctl stop nginx
<span class="token comment"># 启动nginx</span>
systemctl start nginx
<span class="token comment"># 重新载入nginx配置文件</span>
systemctl reload nginx
<span class="token comment"># 查看nginx状态</span>
systemctl status nginx
<span class="token comment"># 设置nginx开机自动启动</span>
systemctl <span class="token builtin class-name">enable</span> nginx
</pre>
                </li>
                <li>
                    <p>有时，我们需要在一台服务器上同时运行我们的web网站，trojan以及v2ray服务，他们都需要使用443端口，而443端口只有一个，因此我们需要在nginx中<strong>对443端口进行分流</strong>，使得3个服务都可以使用443端口。
                    </p>
                    <ul>
                        <li>打开nginx.conf配置文件：</li>
                    </ul>
                    <pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment"># 打开nginx配置文件</span>
<span class="token function">vim</span> /etc/nginx/conf/nginx.conf
</pre>
                    <ul>
                        <li>在配置文件中作出如下的修改：</li>
                    </ul>
                    <pre data-role="codeBlock" data-info="nginx" class="language-nginx"><span
                            class="token keyword">user</span>  nginx<span class="token punctuation">;</span>
<span class="token keyword">pid</span>   <span class="token operator">/</span>var<span class="token operator">/</span>run<span
                                class="token operator">/</span>nginx<span class="token punctuation">.</span><span
                                class="token keyword">pid</span><span class="token punctuation">;</span>

<span class="token comment">####################### 需要修改的分界线 上界 #######################</span>
<span class="token comment"># 此处插入以下内容</span>
<span class="token comment"># 流量转发核心配置</span>
stream <span class="token punctuation">{</span>
    <span class="token comment"># 这里就是 SNI 识别，将域名映射成一个配置名</span>
    <span class="token keyword">map</span> <span class="token variable">$ssl_preread_server_name</span> <span
                                class="token variable">$backend_name</span> <span class="token punctuation">{</span>
        web域名 web<span class="token punctuation">;</span>          <span
                                class="token comment"># 将此处的web域名替换为你自己的web域名</span>
        v2ray域名 vmess<span class="token punctuation">;</span>      <span class="token comment"># 将此处的v2ray域名替换为你自己的v2ray域名</span>
        trojan域名 trojan<span class="token punctuation">;</span>    <span class="token comment"># 将此处的trojan域名替换为你自己的trojan域名</span>
    <span class="token comment"># 域名都不匹配情况下的默认值</span>
        default web<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># web，配置转发详情</span>
    <span class="token keyword">upstream</span> web <span class="token punctuation">{</span>
        <span class="token keyword">server</span> <span class="token number">127.0</span><span
                                class="token number">.0</span><span class="token number">.1</span><span
                                class="token punctuation">:</span><span class="token number">10240</span><span
                                class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># trojan，配置转发详情</span>
    <span class="token keyword">upstream</span> trojan <span class="token punctuation">{</span>
        <span class="token keyword">server</span> <span class="token number">127.0</span><span
                                class="token number">.0</span><span class="token number">.1</span><span
                                class="token punctuation">:</span><span class="token number">10241</span><span
                                class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># vmess，配置转发详情</span>
    <span class="token keyword">upstream</span> vmess <span class="token punctuation">{</span>
        <span class="token keyword">server</span> <span class="token number">127.0</span><span
                                class="token number">.0</span><span class="token number">.1</span><span
                                class="token punctuation">:</span><span class="token number">10242</span><span
                                class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># 监听 443 并开启 ssl_preread</span>
    <span class="token keyword">server</span> <span class="token punctuation">{</span>
        <span class="token keyword">listen</span> <span class="token number">443</span> reuseport<span
                                class="token punctuation">;</span>
        <span class="token keyword">listen</span> <span class="token punctuation">[</span><span
                                class="token punctuation">:</span><span class="token punctuation">:</span><span
                                class="token punctuation">]</span><span class="token punctuation">:</span><span
                                class="token number">443</span> reuseport<span class="token punctuation">;</span>
        <span class="token keyword">proxy_pass</span>  <span class="token variable">$backend_name</span><span
                                class="token punctuation">;</span>
        ssl_preread on<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">####################### 需要修改的分界线 下界 #######################</span>

<span class="token keyword">http</span> <span class="token punctuation">{</span>
  <span class="token comment"># 这块保持不变即可</span>
<span class="token punctuation">}</span>
</pre>
                    <ul>
                        <li>修改完毕后，退出，并重新载入nginx配置文件</li>
                    </ul>
                    <pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment"># 重新载入nginx配置文件</span>
systemctl reload nginx
</pre>
                </li>
                <li>
                    <p>
                        <strong>下载并解压正常网页模板</strong>
                    </p>
                    <pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment"># 新建文件夹</span>
<span class="token function">mkdir</span> /var/www

<span class="token comment"># 从网上下载模板，此处为我自己从网上下载后，并传输到某个网站的模板</span>
<span class="token function">wget</span> https://subconverter.mcmz.xyz/moban.tar.gz -O /var/www/moban.tar.gz
<span class="token function">tar</span> -zxvf /var/www/moban.tar.gz -C /var/www/
</pre>
                </li>
                <li>
                    <p>新建和<strong>v2ray相关的nginx配置文件</strong>
                    </p>
                    <pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment"># 新建名为v2ray.conf的nginx配置文件：</span>
<span class="token function">vim</span> /etc/nginx/conf/conf.d/v2ray.conf
</pre>
                    <ul>
                        <li>然后，在配置文件中输入以下内容：</li>
                    </ul>
                    <pre data-role="codeBlock" data-info="nginx" class="language-nginx"><span class="token keyword">server</span> <span
                            class="token punctuation">{</span>
  <span class="token keyword">listen</span>  <span class="token number">10242</span> <span
                                class="token keyword">ssl</span><span class="token punctuation">;</span>    <span
                                class="token comment"># 之前通过分流，将v2ray的流量分到了10242端口</span>
  <span class="token keyword">ssl</span> on<span class="token punctuation">;</span>
  <span class="token keyword">ssl_certificate</span>       <span class="token operator">/</span>etc<span
                                class="token operator">/</span>v2ray<span class="token operator">/</span>v2ray<span
                                class="token punctuation">.</span>crt<span class="token punctuation">;</span> <span
                                class="token comment"># 此处路径改为之前SSL证书安装路径</span>
  <span class="token keyword">ssl_certificate_key</span>   <span class="token operator">/</span>etc<span
                                class="token operator">/</span>v2ray<span class="token operator">/</span>v2ray<span
                                class="token punctuation">.</span>key<span class="token punctuation">;</span> <span
                                class="token comment"># 此处路径改为之前SSL证书安装路径</span>
  <span class="token keyword">ssl_protocols</span>         TLSv1 TLSv1<span class="token punctuation">.</span><span
                                class="token number">1</span> TLSv1<span class="token punctuation">.</span><span
                                class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">ssl_ciphers</span>           HIGH<span class="token punctuation">:</span><span
                                class="token operator">!</span>aNULL<span class="token punctuation">:</span><span
                                class="token operator">!</span>MD5<span class="token punctuation">;</span>
  <span class="token keyword">server_name</span>           mydomain<span class="token punctuation">.</span>me<span
                                class="token punctuation">;</span>          <span
                                class="token comment"># 此处修改为自己的域名</span>

      <span class="token comment"># 将网站首页伪装成一个网页</span>
      <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
        <span class="token keyword">root</span> <span class="token operator">/</span>var<span
                                class="token operator">/</span>www<span class="token operator">/</span>moban<span
                                class="token punctuation">;</span>  <span class="token comment"># 即之前下载的模板所在的路径</span>
        <span class="token keyword">index</span> <span class="token keyword">index</span><span
                                class="token punctuation">.</span>html<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">location</span> <span class="token operator">/</span>v2ray <span
                                class="token punctuation">{</span> <span class="token comment"># 与 V2Ray 配置中的 path 保持一致，建议自行修改，越复杂越好</span>
      <span class="token keyword">proxy_redirect</span> off<span class="token punctuation">;</span>
      <span class="token comment"># 假设WebSocket监听在环回地址的10000端口上，此端口也可自行修改，最好为5位数，如 10086，且需要与v2ray上的端口相一致；</span>
      <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span
                                class="token punctuation">:</span><span class="token operator">/</span><span
                                class="token operator">/</span><span class="token number">127.0</span><span
                                class="token number">.0</span><span class="token number">.1</span><span
                                class="token punctuation">:</span><span class="token number">10000</span><span
                                class="token punctuation">;</span>
      <span class="token keyword">proxy_http_version</span> <span class="token number">1.1</span><span
                                class="token punctuation">;</span>
      <span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span><span
                                class="token punctuation">;</span>
      <span class="token keyword">proxy_set_header</span> Connection <span
                                class="token string">"upgrade"</span><span class="token punctuation">;</span>
      <span class="token keyword">proxy_set_header</span> Host <span class="token variable">$http_host</span><span
                                class="token punctuation">;</span>

      <span class="token comment"># Show realip in v2ray access.log</span>
      <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Real<span
                                class="token operator">-</span>IP <span class="token variable">$remote_addr</span><span
                                class="token punctuation">;</span>
      <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>Forwarded<span
                                class="token operator">-</span>For <span class="token variable">$proxy_add_x_forwarded_for</span><span
                                class="token punctuation">;</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre>
                    <ul>
                        <li>修改完成后，退出，并重新载入nginx配置文件。</li>
                    </ul>
                    <pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment"># 重新载入nginx配置文件</span>
systemctl reload nginx
</pre>
                </li>
            </ul>
            <h5>
                <center> v2ray部分</center>
            </h5>
            <ul>
                <li>vmess协议要求客户端时间和服务器上的时间必须一致，所以要先对服务器进行<strong>时间校准</strong>确保服务器的时区为东八区
                    <pre
                            data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment"># 查看服务器时间</span>
<span class="token function">date</span> -R

<span class="token comment"># 编辑时区文件</span>
<span class="token function">vim</span> /etc/timezone
</pre>
                    <ul>
                        <li>将文件内容换成</li>
                    </ul>
                    <pre data-role="codeBlock" data-info class="language-"><code>Asia/Shanghai
</code></pre>
                    <ul>
                        <li>保存退出后，在命令行输入</li>
                    </ul>
                    <pre data-role="codeBlock" data-info="bash" class="language-bash"><span
                            class="token function">ln</span> -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime

<span class="token comment"># 然后再次查看服务器的时间</span>
<span class="token function">date</span> -R
<span class="token comment"># 即可看到服务器的时间和本地时间相一致</span>
</pre>
                </li>
                <li><strong>下载安装v2ray</strong>
                    <pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment"># 下载安装脚本</span>
<span class="token function">curl</span> -O https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh

<span class="token comment"># 执行安装程序</span>
<span class="token function">bash</span> install-release.sh

<span class="token comment"># 安装完成后即可通过systemctl启动，关闭或重启v2ray</span>
<span class="token comment"># 启动v2ray</span>
systemctl start v2ray
<span class="token comment"># 关闭v2ray</span>
systemctl stop v2ray
<span class="token comment"># 重启v2ray</span>
systemctl restart v2ray
<span class="token comment"># 查看v2ray状态</span>
systemctl status v2ray
<span class="token comment"># 设置开机自动启动v2ray</span>
systemctl <span class="token builtin class-name">enable</span> v2ray
</pre>
                </li>
                <li><strong>配置v2ray</strong>
                    <ul>
                        <li>打开v2ray配置文件</li>
                    </ul>
                    <pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment"># 打开v2ray配置文件</span>
<span class="token function">vim</span> /usr/local/etc/v2ray/config.json
</pre>
                    <ul>
                        <li>将其内部改为以下内容</li>
                    </ul>
                    <pre data-role="codeBlock" data-info="json" class="language-json"><span
                            class="token punctuation">{</span>
  <span class="token property">"inbounds"</span><span class="token operator">:</span> <span
                                class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"port"</span><span class="token operator">:</span> <span
                                class="token number">10000</span><span class="token punctuation">,</span>        <span
                                class="token comment">//对应此前在Nginx中设置的WebSocket监听在环回地址的10000端口</span>
      <span class="token property">"listen"</span><span class="token operator">:</span><span
                                class="token string">"127.0.0.1"</span><span
                                class="token punctuation">,</span> <span class="token comment">//只监听 127.0.0.1，避免除本机外的机器探测到开放了 10000 端口</span>
      <span class="token property">"protocol"</span><span class="token operator">:</span> <span
                                class="token string">"vmess"</span><span class="token punctuation">,</span>
      <span class="token property">"settings"</span><span class="token operator">:</span> <span
                                class="token punctuation">{</span>
        <span class="token property">"clients"</span><span class="token operator">:</span> <span
                                class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token comment">// 此处为UUID，可直接使用此ID，也可到 https://www.uuidgenerator.net/ 这种生成UUID的网站生成自己的UUID</span>
            <span class="token property">"id"</span><span class="token operator">:</span> <span
                                class="token string">"b831381d-6324-4d53-ad4f-8cda48b30811"</span><span
                                class="token punctuation">,</span>
            <span class="token comment">// 此处为混淆ID，建议数字不要过大，一般填2即可</span>
            <span class="token property">"alterId"</span><span class="token operator">:</span> <span
                                class="token number">64</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"streamSettings"</span><span class="token operator">:</span> <span
                                class="token punctuation">{</span>
        <span class="token property">"network"</span><span class="token operator">:</span> <span
                                class="token string">"ws"</span><span class="token punctuation">,</span>
        <span class="token property">"wsSettings"</span><span class="token operator">:</span> <span
                                class="token punctuation">{</span>
        <span class="token property">"path"</span><span class="token operator">:</span> <span
                                class="token string">"/ray"</span> <span class="token comment">// 此处对应Nginx中设置的ws Direction</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"outbounds"</span><span class="token operator">:</span> <span
                                class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"protocol"</span><span class="token operator">:</span> <span
                                class="token string">"freedom"</span><span class="token punctuation">,</span>
      <span class="token property">"settings"</span><span class="token operator">:</span> <span
                                class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</pre>
                    <ul>
                        <li>修改完成后，即可保存，退出，重启v2ray</li>
                    </ul>
                    <pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment"># 重启v2ray</span>
systemctl restart v2ray
</pre>
                </li>
            </ul>
        </li>
    </ul>
    <h3 class="mume-header" id="trojan">Trojan</h3>

    <ul>
        <li>
            <h4>协议</h4>
            <ul>
                <li><em><strong>trojan</strong></em> 及较新的
                    <em><strong>trojan-go</strong></em>。
                </li>
            </ul>
        </li>
        <li>
            <h4>原理</h4>
            <ul>
                <li>
                    <h5>整体原理：和Shadowsocks相同</h5>
                    <p><img src="/images/GFW-trojan.png" alt="trojan 基本原理"><br></p>
                </li>
                <li>
                    <h5>trojan特色</h5>
                    <blockquote>
                        <h6><br>和v2ray + ws + tls + nginx类似</h6>
                        <p>trojan Local和trojan
                            Server之间通过<strong>TLS加密</strong>进行通信。TLS加密常用于HTTPS网站，因此和访问一般的HTTPS网站流量特征相同。目前GFW很难从每天数以千万计的TLS通信中分辨出哪些是正常的HTTPS网站访问流量，哪些是trojan的翻墙流量，只得将该流量放行。<br><br>
                        </p>
                        <h6>和v2ray + ws + tls + nginx 不同</h6>
                        <p>Trojan会接受来自外界（用户）的web访问请求，这种访问有两种情况：</p>
                        <ol>
                            <li><strong><font
                                    color="#2EA9DF">网页访问请求</font></strong>，trojan会将其引至Nginx并返回给用户正常的网页。因此，从外界来看就是一个简单的网页。并没有任何其他奇怪的功能。
                            </li>
                            <li><strong><font color="#D44931">trojan访问请求</font></strong>，当trojan
                                Server识别出trojan访问请求后，会对外网进行访问，并返回访问结果，实现翻墙效果。<br><br>
                            </li>
                        </ol>
                    </blockquote>
                    <p><img src="/images/GFW-trojan-special.png" alt="trojan 特色"><br></p>
                </li>
            </ul>
        </li>
        <li>
            <h4>优点</h4>
            <ul>
                <li>相较于v2ray + ws + tls + nginx方案而言：搭建稍微简单，ping值相对较低。</li>
                <li>相较于Shadowsocks而言更加安全，且也可以在IP被墙后使用<strong>CDN服务</strong>继续连接被墙服务器。
                </li>
            </ul>
        </li>
        <li>
            <h4>缺点</h4>
            <ul>
                <li>虽然相较于v2ray的搭建而言更简单，但是也还是较为复杂，需要有一定nginx
                    web服务器搭建知识。
                </li>
                <li>协议较新，某些客户端并不支持。</li>
                <li>且ping值相较于Shadowsocks而言还是较高。</li>
            </ul>
        </li>
        <li>
            <h4>建议使用场景</h4>
            <ul>
                <li>所有IPV4 VPS。</li>
            </ul>
        </li>
        <li>
            <h4>搭建方法</h4>
            <h5>
                <center> Nginx部分</center>
            </h5>
            <ul>
                <li>
                    <p>由于要进行TLS通信，所以需要将域名解析到IP上，并<strong>申请SSL证书</strong>。
                    </p>
                    <pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment"># 更新apt-get库并安装域名证书申请所需的库</span>
<span class="token function">apt-get</span> update <span class="token operator">&&</span> <span
                                class="token function">apt-get</span> -y <span class="token function">install</span> socat <span
                                class="token function">curl</span>

<span class="token comment"># 安装acme.sh脚本并让环境变量生效</span>
<span class="token function">curl</span> https://get.acme.sh <span class="token operator">|</span> <span
                                class="token function">sh</span>
<span class="token builtin class-name">source</span> ~/.bashrc

<span class="token comment"># 使用acme.sh签发证书（需要先将域名解析到ip上），***注意将example.com换成自己的域名***</span>
acme.sh --issue -d example.com --standalone -k ec-256 --force

<span class="token comment"># 创建用于存放证书的目录，***注意将example.com换成自己的域名***</span>
<span class="token function">mkdir</span> /data
<span class="token function">mkdir</span> /data/example.com

<span class="token comment"># 安装证书，***注意将example.com换成自己的域名（共3处）***</span>
acme.sh --installcert -d example.com --fullchainpath /data/example.com/fullchain.crt --keypath /data/example.com/privkey.key --ecc --force
</pre>
                </li>
                <li>
                    <p><strong>安装Nginx</strong></p>
                    <pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment"># 下载Nginx安装依赖 (OpenSSL)</span>
<span class="token builtin class-name">cd</span> /usr/local/src
<span class="token function">wget</span> -nc --no-check-certificate https://www.openssl.org/source/openssl-1.1.1g.tar.gz -P /usr/local/src
<span class="token function">tar</span> -zxvf  /usr/local/src/openssl-1.1.1g.tar.gz  -C /usr/local/src
<span class="token comment"># 安装其他依赖</span>
<span class="token function">apt-get</span> -y <span class="token function">install</span> build-essential libpcre3 libpcre3-dev zlib1g-dev <span
                                class="token function">git</span>  dbus manpages-dev <span class="token function">aptitude</span> g++


<span class="token comment"># 下载并解压Nginx</span>
<span class="token function">wget</span> -nc --no-check-certificate http://nginx.org/download/nginx-1.18.0.tar.gz -P /usr/local/src
<span class="token function">tar</span> -zxvf /usr/local/src/nginx-1.18.0.tar.gz -C /usr/local/src


<span class="token comment"># 编译配置</span>
<span class="token builtin class-name">cd</span> /usr/local/src/nginx-1.18.0
<span class="token function">mkdir</span> /etc/nginx
./configure --prefix<span class="token operator">=</span>/etc/nginx <span class="token punctuation">\</span>
        --with-http_ssl_module <span class="token punctuation">\</span>
        --with-http_gzip_static_module <span class="token punctuation">\</span>
        --with-http_stub_status_module <span class="token punctuation">\</span>
        --with-pcre <span class="token punctuation">\</span>
        --with-http_realip_module <span class="token punctuation">\</span>
        --with-http_flv_module <span class="token punctuation">\</span>
        --with-http_mp4_module <span class="token punctuation">\</span>
        --with-http_secure_link_module <span class="token punctuation">\</span>
        --with-http_v2_module <span class="token punctuation">\</span>
        --with-cc-opt<span class="token operator">=</span><span class="token string">&apos;-O3&apos;</span> <span
                                class="token punctuation">\</span>
        --with-openssl<span class="token operator">=</span><span
                                class="token punctuation">..</span>/openssl-1.1.1g <span
                                class="token punctuation">\</span>
        --with-stream <span class="token punctuation">\</span>
        --with-stream_ssl_preread_module
<span class="token comment"># 编译&安装</span>
<span class="token function">make</span> <span class="token operator">&&</span> <span class="token function">make</span> <span
                                class="token function">install</span>
<span class="token comment"># 修改基本配置</span>
<span class="token function">sed</span> -i <span class="token string">&apos;s/#user  nobody;/user  root;/&apos;</span> /etc/nginx/conf/nginx.conf
<span class="token function">sed</span> -i <span class="token string">&apos;s/worker_processes  1;/worker_processes  3;/&apos;</span> /etc/nginx/conf/nginx.conf
<span class="token function">sed</span> -i <span class="token string">&apos;s/    worker_connections  1024;/    worker_connections  4096;/&apos;</span> /etc/nginx/conf/nginx.conf
<span class="token function">sed</span> -i <span class="token string">&apos;<span class="token variable">$i</span> include conf.d/*.conf;&apos;</span> /etc/nginx/conf/nginx.conf


<span class="token comment"># 新建配置文件文件夹</span>
<span class="token function">mkdir</span> /etc/nginx/conf/conf.d


<span class="token comment"># 创建服务文件</span>
<span class="token function">cat</span> <span class="token operator">></span>/etc/systemd/system/nginx.service <span
                                class="token operator"><<</span><span class="token string">EOF
[Unit]
Description=The NGINX HTTP and reverse proxy server
After=syslog.target network.target remote-fs.target nss-lookup.target
[Service]
Type=forking
PIDFile=/etc/nginx/logs/nginx.pid
ExecStartPre=/etc/nginx/sbin/nginx -t
ExecStart=/etc/nginx/sbin/nginx -c /etc/nginx/conf/nginx.conf
ExecReload=/etc/nginx/sbin/nginx -s reload
ExecStop=/bin/kill -s QUIT \<span class="token variable">$MAINPID</span>
PrivateTmp=true
[Install]
WantedBy=multi-user.target
EOF</span>

<span class="token comment"># 重新加载systemctl</span>
systemctl daemon-reload
<span class="token comment"># 重启nginx</span>
systemctl restart nginx

<span class="token comment">## 附nginx其他操作：</span>
<span class="token comment"># 关闭nginx</span>
systemctl stop nginx
<span class="token comment"># 启动nginx</span>
systemctl start nginx
<span class="token comment"># 重新载入nginx配置文件</span>
systemctl reload nginx
<span class="token comment"># 查看nginx状态</span>
systemctl status nginx
<span class="token comment"># 设置nginx开机自动启动</span>
systemctl <span class="token builtin class-name">enable</span> nginx
</pre>
                </li>
                <li>
                    <p>有时，我们需要在一台服务器上同时运行我们的web网站，trojan以及v2ray服务，他们都需要使用443端口，而443端口只有一个，因此我们需要在nginx中<strong>对443端口进行分流</strong>，使得3个服务都可以使用443端口。
                    </p>
                    <ul>
                        <li>打开nginx.conf配置文件：</li>
                    </ul>
                    <pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment"># 打开nginx配置文件</span>
<span class="token function">vim</span> /etc/nginx/conf/nginx.conf
</pre>
                    <ul>
                        <li>在配置文件中作出如下的修改：</li>
                    </ul>
                    <pre data-role="codeBlock" data-info="nginx" class="language-nginx"><span
                            class="token keyword">user</span>  nginx<span class="token punctuation">;</span>
<span class="token keyword">pid</span>   <span class="token operator">/</span>var<span class="token operator">/</span>run<span
                                class="token operator">/</span>nginx<span class="token punctuation">.</span><span
                                class="token keyword">pid</span><span class="token punctuation">;</span>

<span class="token comment">####################### 需要修改的分界线 上界 #######################</span>
<span class="token comment"># 此处插入以下内容</span>
<span class="token comment"># 流量转发核心配置</span>
stream <span class="token punctuation">{</span>
    <span class="token comment"># 这里就是 SNI 识别，将域名映射成一个配置名</span>
    <span class="token keyword">map</span> <span class="token variable">$ssl_preread_server_name</span> <span
                                class="token variable">$backend_name</span> <span class="token punctuation">{</span>
        web域名 web<span class="token punctuation">;</span>          <span
                                class="token comment"># 将此处的web域名替换为你自己的web域名</span>
        v2ray域名 vmess<span class="token punctuation">;</span>      <span class="token comment"># 将此处的v2ray域名替换为你自己的v2ray域名</span>
        trojan域名 trojan<span class="token punctuation">;</span>    <span class="token comment"># 将此处的trojan域名替换为你自己的trojan域名</span>
    <span class="token comment"># 域名都不匹配情况下的默认值</span>
        default web<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># web，配置转发详情</span>
    <span class="token keyword">upstream</span> web <span class="token punctuation">{</span>
        <span class="token keyword">server</span> <span class="token number">127.0</span><span
                                class="token number">.0</span><span class="token number">.1</span><span
                                class="token punctuation">:</span><span class="token number">10240</span><span
                                class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># trojan，配置转发详情</span>
    <span class="token keyword">upstream</span> trojan <span class="token punctuation">{</span>
        <span class="token keyword">server</span> <span class="token number">127.0</span><span
                                class="token number">.0</span><span class="token number">.1</span><span
                                class="token punctuation">:</span><span class="token number">10241</span><span
                                class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># vmess，配置转发详情</span>
    <span class="token keyword">upstream</span> vmess <span class="token punctuation">{</span>
        <span class="token keyword">server</span> <span class="token number">127.0</span><span
                                class="token number">.0</span><span class="token number">.1</span><span
                                class="token punctuation">:</span><span class="token number">10242</span><span
                                class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># 监听 443 并开启 ssl_preread</span>
    <span class="token keyword">server</span> <span class="token punctuation">{</span>
        <span class="token keyword">listen</span> <span class="token number">443</span> reuseport<span
                                class="token punctuation">;</span>
        <span class="token keyword">listen</span> <span class="token punctuation">[</span><span
                                class="token punctuation">:</span><span class="token punctuation">:</span><span
                                class="token punctuation">]</span><span class="token punctuation">:</span><span
                                class="token number">443</span> reuseport<span class="token punctuation">;</span>
        <span class="token keyword">proxy_pass</span>  <span class="token variable">$backend_name</span><span
                                class="token punctuation">;</span>
        ssl_preread on<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">####################### 需要修改的分界线 下界 #######################</span>

<span class="token keyword">http</span> <span class="token punctuation">{</span>
  <span class="token comment"># 这块保持不变即可</span>
<span class="token punctuation">}</span>
</pre>
                    <ul>
                        <li>修改完毕后，退出，并重新载入nginx配置文件</li>
                    </ul>
                    <pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment"># 重新载入nginx配置文件</span>
systemctl reload nginx
</pre>
                </li>
                <li>
                    <p>
                        <strong>下载并解压正常网页模板</strong>
                    </p>
                    <pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment"># 新建文件夹</span>
<span class="token function">mkdir</span> /var/www

<span class="token comment"># 从网上下载模板，此处为我自己从网上下载后，并传输到某个网站的模板</span>
<span class="token function">wget</span> https://subconverter.mcmz.xyz/moban.tar.gz -O /var/www/moban.tar.gz
<span class="token function">tar</span> -zxvf /var/www/moban.tar.gz -C /var/www/
</pre>
                </li>
                <li>
                    <p>新建和<strong>trojan相关的nginx配置文件</strong>
                    </p>
                    <pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment"># 新建名为v2ray.conf的nginx配置文件：</span>
<span class="token function">vim</span> /etc/nginx/conf/conf.d/trojan.conf
</pre>
                    <ul>
                        <li>然后，在配置文件中输入以下内容：</li>
                    </ul>
                    <pre data-role="codeBlock" data-info="nginx" class="language-nginx"><span class="token keyword">server</span> <span
                            class="token punctuation">{</span>
  <span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
  <span class="token keyword">server_name</span>  mydomain<span class="token punctuation">.</span>me<span
                                class="token punctuation">;</span>          <span
                                class="token comment"># 此处修改为自己的域名</span>

  <span class="token comment"># 将网站首页伪装成一个网页</span>
  <span class="token keyword">location</span> <span class="token operator">/</span> <span
                                class="token punctuation">{</span>
    <span class="token keyword">root</span> <span class="token operator">/</span>var<span
                                class="token operator">/</span>www<span class="token operator">/</span>moban<span
                                class="token punctuation">;</span>  <span class="token comment"># 即之前下载的模板所在的路径</span>
    <span class="token keyword">index</span> <span class="token keyword">index</span><span
                                class="token punctuation">.</span>html<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre>
                    <ul>
                        <li>修改完成后，退出，并重新载入nginx配置文件。</li>
                    </ul>
                    <pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment"># 重新载入nginx配置文件</span>
systemctl reload nginx
</pre>
                </li>
            </ul>
            <h5>
                <center> trojan部分</center>
            </h5>
            <ul>
                <li><strong>下载安装trojan</strong>
                    <pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment"># 下载安装trojan</span>
<span class="token function">sudo</span> <span class="token function">bash</span> -c <span
                                class="token string">"<span class="token variable"><span
                                class="token variable">$(</span><span class="token function">curl</span> -fsSL https://raw.githubusercontent.com/trojan-gfw/trojan-quickstart/master/trojan-quickstart.sh<span
                                class="token variable">)</span></span>"</span>

<span class="token comment"># 安装完成后即可通过systemctl启动，关闭或重启trojan</span>
<span class="token comment"># 启动trojan</span>
systemctl start trojan
<span class="token comment"># 关闭trojan</span>
systemctl stop trojan
<span class="token comment"># 重启trojan</span>
systemctl restart trojan
<span class="token comment"># 查看trojan状态</span>
systemctl status trojan
<span class="token comment"># 设置开机自动启动trojan</span>
systemctl <span class="token builtin class-name">enable</span> trojan
</pre>
                </li>
                <li><strong>编辑trojan配置文件</strong>
                    <ul>
                        <li>打开trojan配置文件</li>
                    </ul>
                    <pre data-role="codeBlock" data-info="bash" class="language-bash"><span class="token comment"># 打开trojan配置文件</span>
<span class="token function">vim</span> /usr/local/etc/trojan/config.json
</pre>
                    <ul>
                        <li>将配置文件替换为以下内容<br>
                            <strong>
                                <center>输入后，请务必把注释（//打头的内容）删除</center>
                            </strong></li>
                    </ul>
                    <pre data-role="codeBlock" data-info="json" class="language-json"><span
                            class="token punctuation">{</span>
  <span class="token property">"run_type"</span><span class="token operator">:</span> <span
                                class="token string">"server"</span><span class="token punctuation">,</span>
  <span class="token property">"local_addr"</span><span class="token operator">:</span> <span
                                class="token string">"0.0.0.0"</span><span class="token punctuation">,</span>
  <span class="token comment">// Nginx对443端口分流时，给trojan的端口，若未对443端口进行分流，请直接使用443端口</span>
  <span class="token property">"local_port"</span><span class="token operator">:</span> <span
                                class="token number">10241</span><span class="token punctuation">,</span>
  <span class="token property">"remote_addr"</span><span class="token operator">:</span> <span
                                class="token string">"127.0.0.1"</span><span
                                class="token punctuation">,</span>
  <span class="token property">"remote_port"</span><span class="token operator">:</span> <span
                                class="token number">80</span><span class="token punctuation">,</span>
  <span class="token property">"password"</span><span class="token operator">:</span> <span
                                class="token punctuation">[</span>
      <span class="token string">"设定的密码，连接trojan时需要用到"</span><span
                                class="token punctuation">,</span>           <span class="token comment">// 设定的密码，连接trojan时需要用到 </span>
      <span class="token string">""</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"log_level"</span><span class="token operator">:</span> <span
                                class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">"ssl"</span><span class="token operator">:</span> <span
                                class="token punctuation">{</span>
      <span class="token property">"cert"</span><span class="token operator">:</span> <span
                                class="token string">"/data/example.com/fullchain.crt"</span><span
                                class="token punctuation">,</span>  <span
                                class="token comment">// 证书地址，参考之前SSL证书安装的地址</span>
      <span class="token property">"key"</span><span class="token operator">:</span> <span
                                class="token string">"/data/example.com/privkey.key"</span><span
                                class="token punctuation">,</span>     <span class="token comment">// 密钥地址，参考之前SSL证书安装的地址</span>
      <span class="token property">"key_password"</span><span class="token operator">:</span> <span
                                class="token string">""</span><span class="token punctuation">,</span>
      <span class="token property">"cipher"</span><span class="token operator">:</span> <span
                                class="token string">"ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256"</span><span
                                class="token punctuation">,</span>
      <span class="token property">"prefer_server_cipher"</span><span class="token operator">:</span> <span
                                class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token property">"alpn"</span><span class="token operator">:</span> <span
                                class="token punctuation">[</span>
          <span class="token string">"http/1.1"</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"reuse_session"</span><span class="token operator">:</span> <span
                                class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token property">"session_ticket"</span><span class="token operator">:</span> <span
                                class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token property">"session_timeout"</span><span class="token operator">:</span> <span
                                class="token number">600</span><span class="token punctuation">,</span>
      <span class="token property">"plain_http_response"</span><span class="token operator">:</span> <span
                                class="token string">""</span><span class="token punctuation">,</span>
      <span class="token property">"curves"</span><span class="token operator">:</span> <span
                                class="token string">""</span><span class="token punctuation">,</span>
      <span class="token property">"dhparam"</span><span class="token operator">:</span> <span
                                class="token string">""</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"tcp"</span><span class="token operator">:</span> <span
                                class="token punctuation">{</span>
      <span class="token property">"prefer_ipv4"</span><span class="token operator">:</span> <span
                                class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token property">"no_delay"</span><span class="token operator">:</span> <span
                                class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token property">"keep_alive"</span><span class="token operator">:</span> <span
                                class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token property">"fast_open"</span><span class="token operator">:</span> <span
                                class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token property">"fast_open_qlen"</span><span class="token operator">:</span> <span
                                class="token number">20</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"mysql"</span><span class="token operator">:</span> <span
                                class="token punctuation">{</span>
      <span class="token property">"enabled"</span><span class="token operator">:</span> <span
                                class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token property">"server_addr"</span><span class="token operator">:</span> <span
                                class="token string">"127.0.0.1"</span><span
                                class="token punctuation">,</span>
      <span class="token property">"server_port"</span><span class="token operator">:</span> <span
                                class="token number">3306</span><span class="token punctuation">,</span>
      <span class="token property">"database"</span><span class="token operator">:</span> <span
                                class="token string">"trojan"</span><span class="token punctuation">,</span>
      <span class="token property">"username"</span><span class="token operator">:</span> <span
                                class="token string">"trojan"</span><span class="token punctuation">,</span>
      <span class="token property">"password"</span><span class="token operator">:</span> <span
                                class="token string">""</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre>
                </li>
            </ul>
        </li>
    </ul>

</div>


</body>
</html>